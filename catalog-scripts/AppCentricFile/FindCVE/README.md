# 🔍 FindCVE – OPSWAT App-Centric CVE Lookup Tool

**FindCVE.py** is a Python utility that scans an OPSWAT **App-Centric JSON catalog** (`app_centric.json`) and identifies all products that reference a specific **CVE (Common Vulnerabilities and Exposures)**.  
It can also automatically regenerate the catalog if it is missing or older than two hours, using OPSWAT’s `gen_app_centric_file` module.

---

## 📦 Features

- Reads **app_centric.json** generated by the OPSWAT Analog Catalog.
- Searches for any **CVE ID** across:
  - `products[].vulnerabilities[].cve`
  - `products[].patches[].cve`
- Displays all matching products, including:
  - Product name, vendor, and product line
  - Associated patch or vulnerability information
- Converts and displays the catalog’s **local release date**.
- Writes a detailed, timestamped **results file** (`results_<CVE>_<timestamp>.txt`).
- Automatically regenerates the app_centric file if outdated or missing.

---

## 🧰 Requirements

- **Python 3.8+**
- Access to OPSWAT’s `gen_app_centric_file.py` script (included under `../AppCentricFile`)
- `analog.zip` token (for catalog regeneration)

---

## ⚙️ Installation

```bash
git clone <your-repo>
cd <your-repo>
pip install -r requirements.txt  # if dependencies exist
```

Ensure that:
- `FindCVE.py` and `app_centric.json` are in the same working directory, **or**
- You provide paths via command-line arguments.

---

## 🚀 Usage

### Basic example
```bash
python FindCVE.py --cve CVE-2022-27167
```

This will:
1. Ensure the `app_centric.json` file exists and is fresh (auto-regenerates if older than 2 hours).
2. Search for all products referencing `CVE-2022-27167`.
3. Display matches in the terminal.
4. Write a results file such as:
   ```
   results_CVE-2022-27167_20251009_193045.txt
   ```

---

### Full command-line options

| Argument | Description | Default |
|-----------|--------------|----------|
| `--cve` | CVE ID to search (e.g., `CVE-2022-27167`) | `UNKNOWN` |
| `--appcentric` | Path to the app-centric JSON file | `app_centric.json` |
| `--catalogdir` | Directory for extracted OPSWAT catalog | `./CatalogExtract` |
| `--tokenfile` | Path to the OPSWAT `download_token.txt` | `download_token.txt` |

---

## 🧩 Output Example

```
Products referencing CVE-2022-27167:
------------------------------------------------------------
Product: Mozilla Firefox (sig_id: 3039)
Vendor:  Mozilla Corporation
Line:    Mozilla Firefox
Vulnerabilities:
  CVE: CVE-2022-27167, CPE: cpe:/a:mozilla:firefox, Ranges: [{'start': '90.0', 'end': '97.0'}]
Patch Hits:
  Patch: Mozilla Firefox, Version: 97.0.1, Bulletin: TPL22DKJ, Release Date: 2022-03-12, Reboot Required: False, Architectures: ['x64']

Catalog release date (local time): 2025-10-09 19:46:31
Results written to: results_CVE-2022-27167_20251009_194000.txt
```

---

## 🧠 Internals

| Function | Purpose |
|-----------|----------|
| `load_products()` | Recursively extracts `products[]` from JSON |
| `normalize_cve()` | Standardizes CVE string comparisons |
| `product_matches_cve()` | Checks a single product for matching CVEs |
| `find_products_by_cve()` | Scans all products and aggregates matches |
| `get_local_release_date()` | Converts catalog meta timestamp to local time |
| `ensure_app_centric_file()` | Rebuilds catalog if missing or older than 2 hours |
| `write_results_to_file()` | Writes formatted results to a text file |
| `report_cve_matches()` | Main lookup routine (prints + writes results) |

---

## 🧩 Integration with OPSWAT SDK

`FindCVE.py` leverages OPSWAT’s **AppCentricFile** format for mapping CVEs and patches to products.  
It can be integrated into automated vulnerability analysis pipelines or partner OEM workflows.

---

## 🪪 License
© OPSWAT, Inc. – Internal/Partner Use Only.  
Redistribution without permission is prohibited.
