///////////////////////////////////////////////////////////////////////////////////////////////
///  Sample Code for scan-vuln
///  Reference Implementation using OPSWAT Endpoint Vulnerability Module
///  
///  Created by Chris Seiler
///  OPSWAT OEM Solutions Architect
///////////////////////////////////////////////////////////////////////////////////////////////

using System;
using System.Runtime.InteropServices;

namespace scan_vuln.sdk_pipe
{

    //
    // This class is used to create an Adapter between C# and C++ code.
    // This exports the functions that will need to used to integrate using the SDK_PIPE SDK
    // Note the use of the custom XStringMarshaler
    //
    public class SDK_Adapter
    {
        const string LIB_WAAPI = "libwaapi";
        [DllImport(LIB_WAAPI, CallingConvention = CallingConvention.StdCall, CharSet = CharSet.Auto)]
        public static extern int wa_api_setup([MarshalAs(UnmanagedType.CustomMarshaler, MarshalTypeRef = typeof(XStringMarshaler))] string json_config,
                                                out IntPtr json_out);

        [DllImport(LIB_WAAPI, CallingConvention = CallingConvention.StdCall, CharSet = CharSet.Auto)]
        public static extern int wa_api_invoke([MarshalAs(UnmanagedType.CustomMarshaler, MarshalTypeRef = typeof(XStringMarshaler))] string json_config,
                                                out IntPtr json_out);

        [DllImport(LIB_WAAPI, CallingConvention = CallingConvention.StdCall, CharSet = CharSet.Auto)]
        public static extern int wa_api_teardown();

        [DllImport(LIB_WAAPI, CallingConvention = CallingConvention.StdCall, CharSet = CharSet.Auto)]
        public static extern int wa_api_free(IntPtr json_data);
    }
}
